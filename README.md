# RL Trading Bot — NQ Futures

Reinforcement Learning агент для торговли NQ (Nasdaq-100 Futures) на минутных данных.

## Архитектура

```
Данные (CSV) → Индикаторы → Trading Environment (Gym) → PPO Agent → Решения (Buy/Sell/Hold)
```

### Что видит агент (State)
- 50 последних баров с 22 техническими индикаторами
- RSI, MACD, Bollinger Bands, ATR, Stochastic, скользящие средние
- Текущая позиция, нереализованный P&L, изменение баланса

### Действия (Actions)
- `0` = HOLD (ничего не делать)
- `1` = BUY (открыть/перевернуть лонг)
- `2` = SELL (открыть/перевернуть шорт)

### Награда (Reward)
- Изменение P&L за шаг
- Штраф за частые сделки
- Штраф за просадку > 5%
- Бонус за прибыльные сделки

## Быстрый старт

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Обучение агента

```bash
python train.py
```

Обучение на CPU займёт 1-4 часа (500K шагов на 5-мин барах).
С GPU — значительно быстрее.

### 3. Оценка (бэктест)

```bash
python evaluate.py
```

Покажет equity curve, статистику, Sharpe ratio, drawdown.

## Структура файлов

```
├── config.py          # Конфигурация (параметры обучения, среды)
├── data_loader.py     # Загрузка и предобработка CSV данных
├── indicators.py      # Технические индикаторы (RSI, MACD, BB, ATR...)
├── trading_env.py     # Gymnasium среда — "игра" для агента
├── train.py           # Обучение PPO агента
├── evaluate.py        # Бэктест и визуализация результатов
├── requirements.txt   # Зависимости
├── models/            # Сохранённые модели
├── results/           # Графики и статистика
└── *.csv              # Минутные данные NQ (2012-2025)
```

## Настройка

Все параметры в `config.py`:

| Параметр | Описание | По умолчанию |
|----------|----------|-------------|
| `RESAMPLE_MINUTES` | Ресемплинг баров (5=5мин) | 5 |
| `WINDOW_SIZE` | Окно наблюдения (в барах) | 50 |
| `TOTAL_TIMESTEPS` | Шагов обучения | 500,000 |
| `LEARNING_RATE` | Скорость обучения | 3e-4 |
| `NET_ARCH` | Архитектура нейросети | [256, 256] |
| `TRAIN_END_DATE` | Дата разделения train/test | 2022-01-01 |

### Для более серьёзного обучения:
- `TOTAL_TIMESTEPS = 2_000_000`
- `RESAMPLE_MINUTES = 1` (на 1-мин барах, нужен GPU)
- `NET_ARCH = [512, 512, 256]`

## GPU ускорение

Для обучения на GPU установите PyTorch с CUDA:

```bash
pip install torch --index-url https://download.pytorch.org/whl/cu121
```

## Следующие шаги

1. **Запустить базовое обучение** на 5-мин барах (CPU, ~2 часа)
2. **Проверить backtest** — если Sharpe > 1.0, агент перспективен
3. **Увеличить обучение** — больше шагов, меньше ресемплинг
4. **Paper trading** — подключить к live данным без реальных денег
5. **Оптимизация** — гиперпараметры, reward shaping, больше features
